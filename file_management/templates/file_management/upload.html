{% extends 'file_management/base.html' %}

{% block content %}
<section class="file-management">
   <div class="file-management--container">
      <h1 class="h1">Uploading a File</h1>

      <form id="my_form" method="POST" action="{% url 'file-management:upload' %}" enctype="multipart/form-data">
         {% csrf_token %}
         <div class="container">
            <div class="columns">
               <div class="column">
                  <input id="name" class="input" type="text" placeholder="Text input" name="name">
               </div>
               <div class="column">
                  <input id="file" class="input" type="file" placeholder="Text input" name="file">
               </div>
            </div>
            <div class="columns">
               <div class="column">
                  <select name="category_id" id="category">
                     {% if category_list %}
                     {% for category in category_list %}
                     <option value="{{category.id}}">{{category.title}}</option>
                     {% endfor %}
                     {% else %}
                     <option value="0">No categories yet</option></a>
                     {% endif %}
                  </select>
               </div>
            </div>
            <div class="columns">
               <div class="column">
                  <textarea class="textarea" placeholder="e.g. Hello world" name="description"></textarea>
               </div>
            </div>
            <div class="columns">
               <div class="column">
                  <button class="button is-dark">Cancel</button>
                  <button class="button is-dark" type="submit">Upload File</button>
               </div>
            </div>
         </div>
      </form>


   </div>
</section>


<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
   $(document).ready(function () {

      $("#my_form").submit(function(e){
         var name = $("#name").val();
         var file_length = $("#file").get(0).files.length;
         var file_size = $("#file").get(0).files[0].size;
         var category = $("#category").val();

         if (name.trim() == "") {
            Swal.fire({
               icon: 'error',
               title: "Please enter a valid file name."
            })
            return false;
         } else if (file_length == 0) {
            Swal.fire({
               icon: 'error',
               title: "Ooops, you forgot to select a file!"
            })
            
            return false;
         } else if (file_size > 524288000) {
            Swal.fire({
               icon: 'error',
               title: "Your file is too big, please no more than 500mb!"
            })
            return false;
         } else if (category == "0") {
            Swal.fire({
               icon: 'error',
               title: "Please select a valid category."
            })
            
            return false;
         }

         return true;
      });
   });
</script>

{% endblock %}