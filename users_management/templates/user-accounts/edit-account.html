{% extends 'user-accounts/base.html' %}

{% block content %}
{% load static %}
{% for detail in users %}
<h1 class="h1">Editing an account</h1>
<section class="edit-accounts">
    <div class="edit-accounts--container">
          <div class="my-profile--image">
             <img src="{% static 'src/images/profile-image-large.png' %}" alt="profile-image-large">
             <h4 class="h4">{{ detail.username }}</h4>
             <p>username</p>
          </div>
          <div class="edit-accounts--form-container">
            <form action="{%  url 'SaveChangesOnEditUserAccount' %}" method="POST" id='SaveChangesForm' autocomplete='off'>
              {% csrf_token %}
                <div class="row">
                    <div class="col-12">
                      <h4>Fill up all the information.</h4>
                    </div>
                </div>
                <div class="row">
                   <div class="col-12">
                    <input type="text" value="{{ detail.username }}"  name='username' id ='username'>
                    <input type="text" value="{{ detail.pk }}" name='PK' style="display:none"> 
                   </div>
                </div>
                <div class="row">
                    <div class="col-12">
                     <input type="text" placeholder="Enter first name"  value="{{ detail.first_name }}"  name='first_name'
                     id ='first_name'> 
                    </div>
                 </div>
                 <div class="row">
                    <div class="col-12">
                     <input type="text" placeholder="Enter middle name"  value="{{ detail.middle_name }}"  name='middle_name'
                     id ='middle_name'> 
                    </div>
                 </div>
                 <div class="row">
                    <div class="col-12">
                     <input type="text" placeholder="Enter last name"  value="{{ detail.last_name }}"  name='last_name'
                     id ='last_name'> 
                    </div>
                 </div>
                 <div class="row">
                    <div class="col-12">
                     <input type="text" placeholder="Enter address"  value="{{ detail.address }}"  name='address'
                     id ='address'> 
                    </div>
                 </div>
                 <div class="row">
                    <div class="col-12">
                     <input type="text" placeholder="Enter email address"  value="{{ detail.email }}"  name='email'
                     id ='email'> 
                    </div>
                 </div>

                <div class="row">
                    <div class="col-12 birthday">
                        <input type="date" name="bday" id="birthday" placeholder="Select birthdate*" value='{{ bday }}'> 
                    </div>
                </div>
                <input type="text" name='asd' id='hiddeGender' value='{{ detail.gender }}' style='display:none'>
                <fieldset class="gender" id="group">
                    <p>Select gender*</p>
                    <div>
                        <input type="radio" id="Woman" name="group" value="1"
                              >
                        <label for="Woman">Woman</label>
                      </div>
                      
                      <div>
                        <input type="radio" id="Man" name="group" value="2">
                        <label for="Man">Man</label>
                      </div>
                      
                      <div>
                        <input type="radio" id="Others" name="group" value="3">
                        <label for="Others">Others</label>
                      </div>
                </fieldset>
                <div class="row">
                   <div class="col-12 btn-holder">
                    <a href="javascript:history.back()" class="btn-black">Cancel</a>
                    <div class="btn-black" onclick ='onClickSaveButton({{ invalidUsernames }})'>Save Account</div>
                   </div>
                </div>
            </form>
          </div>
    </div>
 </section>


 <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>

   //for gender (edit)
   if(document.getElementById('hiddeGender').value == 1){
      document.getElementById('Woman').checked = true;
      document.getElementById('renaethisforgender').textContent = 'Woman';
   }
   else if (document.getElementById('hiddeGender').value == 2){
      document.getElementById('Man').checked = true;
      document.getElementById('renaethisforgender').textContent = 'Man';
   }
   else{
      document.getElementById('Others').checked = true;
      document.getElementById('renaethisforgender').textContent = 'Others';
   }

   //end gender

   //save Changes
  function onClickSaveButton(listOfUsernames) {
    //validate
    var username = document.getElementById('username').value;
    var firstname = document.getElementById('first_name').value;
    var middleName = document.getElementById('middle_name').value;
    var lastname = document.getElementById('last_name').value;
    var address = document.getElementById('address').value;
    var email = document.getElementById('email').value;
      // Validate
      if(username == '' || firstname == '' || lastname == '' || address == '' || middleName == '' || email == ''){
         Swal.fire({
            icon: 'warning',
            title: "All fields are required",
            confirmButtonText: 'Ok',
         })
      }else{
         //check if username is duplicated
         var isDuplicate = false;
          for(var i = 0 ; i < listOfUsernames.length; i++){
            if(i+1 == listOfUsernames.length){
              //last index
              if(listOfUsernames[i] == username){
                isDuplicate = true;
              }
                if(!isDuplicate){
                  //Save To DB
                  Swal.fire({
                     icon: 'success',
                     allowOutsideClick: false,
                     title: "Changes has been saved",
                     confirmButtonText: 'Great',
                  }).then(() => {
                     document.getElementById('SaveChangesForm').submit()
                  })
                  
                }else{
                  //Error Message
                  Swal.fire({
                     icon: 'error',
                     title: "Username is already taken.",
                     confirmButtonText: 'Ok',
                  })
                }
            }else{
              if(listOfUsernames[i] == username){
                isDuplicate = true;
              }
            }
          }
      }
   }

  
</script>
 
{% endfor %}
{% endblock %}